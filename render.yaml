services:
  # API Server - Long-lived Node.js backend with Fastify
  - type: web
    name: api-server
    runtime: docker
    dockerfilePath: ./apps/api-server/Dockerfile
    dockerContext: .
    region: oregon # Change to your preferred region
    plan: starter # Free tier available
    branch: main
    autoDeploy: true

    # Health check configuration
    healthCheckPath: /health

    # Environment variables
    envVars:
      - key: NODE_ENV
        value: production

      - key: PORT
        value: 4000

      - key: HOST
        value: 0.0.0.0

      - key: DATABASE_URL
        fromDatabase:
          name: postgres-db
          property: connectionString

      - key: BETTER_AUTH_SECRET
        generateValue: true

      - key: BETTER_AUTH_URL
        value: https://api-server.onrender.com # Update with your Render domain

      - key: CORS_ORIGIN
        value: https://yourdomain.com # Update with your Next.js frontend URL

      - key: LOG_LEVEL
        value: info

# PostgreSQL database (optional - if not using external DB)
databases:
  - name: postgres-db
    databaseName: softwaremultitool
    plan: starter # Free tier available
    region: oregon # Must match service region
    postgresMajorVersion: 16
